#!/usr/bin/env bash

    # tmux new-session -c "$HOME/.dotfiles" -d -s _dotfiles
    # tmux send-keys -t _dotfiles " sleep 0.2 && clear && fastfetch --logo $HOME/.dotfiles/fastfetch/tmux.txt" C-m
    # tmux new-session -d -s Obsidian
    # tmux send-keys -t Obsidian " zk" C-m
    # tmux attach -t _dotfiles

function session_exists {
    if tmux list-sessions | grep "$1"; then
        return 0
    else
        return 1
    fi
}

default=_

# Only start new sessions if they don't already exist
if ! pgrep -x 'tmux' > /dev/null || [[ -n $(session_exists $default) ]]; then

    tmux new-session -d -s $default 'btop'
    tmux rename-window -t $default 'main'

    # these numbers are crazy because tmux doesn't actually know the size of my
    # terminal window while these commands are running
    tmux split-window -t _ -l 64 -h 'weather'
    tmux split-window -t _ -l 6 -h 'moon'

    tmux split-window -t _ -vf
    tmux send-keys -t $default " sleep 0.2 && clear && fastfetch --logo $HOME/.dotfiles/fastfetch/tmux.txt" C-m

    tmux split-window -t _ -h 'cmus'

    tmux new-session -d -s Obsidian
    tmux send-keys -t Obsidian " zk" C-m

fi

if [[ -z "$TMUX" ]]; then
    # attach to session 1 if exists and not already attached to a session
    tmux attach-session -t $default:1.3
else
    # put focus for session 1 on the bottom left pane
    tmux select-pane -t $default:1.3
fi
